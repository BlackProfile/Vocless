<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vocal Remover AI</title>
    <!-- Tailwind CSS untuk styling modern dan responsif -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e;
            color: #e0e0e0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            background-color: #2c2b3e;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            max-width: 900px;
            width: 100%;
        }
        .card {
            background-color: #3f3e53;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .file-input-label {
            display: inline-block;
            background-color: #6a40e8;
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }
        .file-input-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(106, 64, 232, 0.4);
        }
        #waveform-canvas, #visualizer-canvas {
            width: 100%;
            height: 150px;
            background-color: #333246;
            border-radius: 8px;
            border: 1px solid #5a5a73;
            margin-bottom: 10px;
        }
        .chord-box {
            background-color: #333246;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-size: 1.25rem;
            font-weight: 600;
            color: #fca311;
        }
        .placeholder-text {
            color: #9ca3af;
            font-style: italic;
        }
        .title {
            color: #8c8c9a;
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 p-8">
    <div class="container mx-auto">
        <div class="text-center mb-10">
            <h1 class="text-4xl font-bold text-white mb-2">Vocal Remover & Chord Detector</h1>
            <p class="text-lg text-gray-400">Unggah file audio Anda untuk memisahkan vokal dan mendeteksi chord.</p>
        </div>

        <!-- Bagian Unggah File -->
        <div class="card text-center mb-8">
            <label for="audioFile" class="file-input-label">
                Unggah Lagu (mp3, wav)
            </label>
            <input type="file" id="audioFile" class="hidden" accept=".mp3, .wav, .aac">
        </div>

        <!-- Bagian Pemutar dan Waveform -->
        <div class="card">
            <h2 class="text-xl title mb-4">Lagu Diputar: <span id="songTitle" class="text-white font-normal placeholder-text">Belum ada lagu yang diunggah</span></h2>
            <audio id="audioPlayer" controls class="w-full mb-4"></audio>
            <!-- Canvas untuk visualisasi waveform statis -->
            <canvas id="waveform-canvas"></canvas>
            <!-- Canvas untuk visualisasi audio bar dinamis -->
            <canvas id="visualizer-canvas"></canvas>
            <p id="loading-message" class="text-center text-yellow-500 mt-2 hidden">Memuat audio...</p>
        </div>

        <!-- Bagian Hasil -->
        <div class="grid md:grid-cols-2 gap-6 mt-8">
            <!-- Vokal dan Musik -->
            <div class="card">
                <h2 class="text-xl title mb-4">Vokal & Musik</h2>
                <div id="vocalResult" class="mb-4">
                    <p class="placeholder-text">Hasil pemisahan vokal akan muncul di sini.</p>
                    <p class="placeholder-text text-sm mt-1">
                        *(Simulasi: Fitur ini membutuhkan AI dan pemrosesan backend yang canggih. Bagian ini hanyalah placeholder.)*
                    </p>
                </div>
            </div>
            <!-- Deteksi Chord -->
            <div class="card">
                <h2 class="text-xl title mb-4">Deteksi Chord</h2>
                <div id="chordResult" class="flex flex-wrap gap-2 justify-center">
                    <p class="placeholder-text">Chord akan dideteksi dan ditampilkan di sini.</p>
                    <p class="placeholder-text text-sm mt-1">
                        *(Simulasi: Fitur ini membutuhkan analisis audio yang kompleks. Bagian ini hanyalah placeholder.)*
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Mendapatkan elemen DOM yang dibutuhkan ---
        const audioFile = document.getElementById('audioFile');
        const audioPlayer = document.getElementById('audioPlayer');
        const songTitle = document.getElementById('songTitle');
        const waveformCanvas = document.getElementById('waveform-canvas');
        const visualizerCanvas = document.getElementById('visualizer-canvas');
        const loadingMessage = document.getElementById('loading-message');
        const waveformCtx = waveformCanvas.getContext('2d');
        const visualizerCtx = visualizerCanvas.getContext('2d');

        // --- Variabel untuk Web Audio API ---
        let audioContext, analyser, source;

        // --- Mendengarkan saat pengguna mengunggah file ---
        audioFile.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                loadingMessage.classList.remove('hidden');
                songTitle.textContent = file.name;

                // Menggunakan URL objek untuk pemutar audio
                const audioUrl = URL.createObjectURL(file);
                audioPlayer.src = audioUrl;

                // Menggunakan FileReader untuk membaca data untuk waveform
                const reader = new FileReader();
                reader.onload = async (e) => {
                    const audioBuffer = await new (window.AudioContext || window.webkitAudioContext)().decodeAudioData(e.target.result);
                    drawWaveform(audioBuffer);
                    loadingMessage.classList.add('hidden');
                };
                reader.readAsArrayBuffer(file);
            }
        });

        // --- Mengatur visualizer saat lagu diputar ---
        audioPlayer.addEventListener('play', () => {
            // Pastikan AudioContext dibuat hanya sekali
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                source = audioContext.createMediaElementSource(audioPlayer);
                analyser = audioContext.createAnalyser();

                // Mengatur properti analyser
                analyser.fftSize = 256;
                source.connect(analyser);
                analyser.connect(audioContext.destination);
            }
            drawVisualizer();
        });

        // --- Fungsi untuk menggambar waveform statis ---
        function drawWaveform(buffer) {
            const width = waveformCanvas.width;
            const height = waveformCanvas.height;
            const data = buffer.getChannelData(0);
            const step = Math.ceil(data.length / width);
            const amp = height / 2;
            
            waveformCtx.clearRect(0, 0, width, height);
            waveformCtx.beginPath();
            waveformCtx.strokeStyle = '#fca311';
            waveformCtx.lineWidth = 2;
            waveformCtx.shadowColor = '#fca311';
            waveformCtx.shadowBlur = 10;
            waveformCtx.moveTo(0, amp);

            for (let i = 0; i < width; i++) {
                let min = 1.0;
                let max = -1.0;
                for (let j = 0; j < step; j++) {
                    const datum = data[(i * step) + j];
                    if (datum < min) min = datum;
                    if (datum > max) max = datum;
                }
                waveformCtx.lineTo(i, (1 + min) * amp);
                waveformCtx.lineTo(i, (1 + max) * amp);
            }
            waveformCtx.stroke();
            waveformCtx.shadowBlur = 0;
        }

        // --- Fungsi untuk menggambar visualizer bilah dinamis ---
        function drawVisualizer() {
            // Jika audio tidak diputar, hentikan visualisasi
            if (audioPlayer.paused) {
                return;
            }

            // Mengambil data frekuensi
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            analyser.getByteFrequencyData(dataArray);

            // Menggambar visualisasi
            visualizerCtx.clearRect(0, 0, visualizerCanvas.width, visualizerCanvas.height);

            const barWidth = (visualizerCanvas.width / bufferLength) * 2.5;
            let barHeight;
            let x = 0;

            for(let i = 0; i < bufferLength; i++) {
                barHeight = dataArray[i];

                // Menentukan warna bilah
                const r = barHeight + (25 * (i/bufferLength));
                const g = 250 * (i/bufferLength);
                const b = 50;
                visualizerCtx.fillStyle = `rgb(${r}, ${g}, ${b})`;
                
                // Menggambar bilah
                visualizerCtx.fillRect(x, visualizerCanvas.height - barHeight, barWidth, barHeight);

                x += barWidth + 1;
            }

            // Memanggil fungsi ini lagi untuk loop animasi
            requestAnimationFrame(drawVisualizer);
        }

        // --- Menyesuaikan ukuran canvas saat halaman dimuat ---
        window.onload = () => {
            waveformCanvas.width = waveformCanvas.offsetWidth;
            waveformCanvas.height = waveformCanvas.offsetHeight;
            visualizerCanvas.width = visualizerCanvas.offsetWidth;
            visualizerCanvas.height = visualizerCanvas.offsetHeight;
        };
    </script>
</body>
</html>
